<div class="filtros">
  <h2 (click)="toggleFilterOptions()">Gestión de Productos de venta</h2>
  <div class="btn-filtros" *ngIf="filterOptionsVisible">
    <button (click)="selectFilter('crear')">Crear Producto</button>
    <button (click)="selectFilter('editar')">Editar Producto</button>
  </div>
</div>

<div *ngIf="selectedFilter === 'crear'" class="section-form">
  <h2>Crear Producto</h2>
  <form [formGroup]="createForm" (ngSubmit)="createProduct()" class="form-group">
    <input formControlName="nom_prod" placeholder="Nombre del Producto" type="text" 
      [ngClass]="{'input-error': createForm.get('nom_prod')?.invalid && createForm.get('nom_prod')?.touched}" required maxlength="30" pattern="^[A-Za-zÁÉÍÓÚáéíóúÑñ\s]{1,30}$" />
    <div *ngIf="createForm.get('nom_prod')?.invalid && createForm.get('nom_prod')?.touched" class="mensaje-error">Nombre inválido.</div>

    <input formControlName="descripcion" placeholder="Descripción" type="text" 
      [ngClass]="{'input-error': createForm.get('descripcion')?.invalid && createForm.get('descripcion')?.touched}" required maxlength="100" />
    <div *ngIf="createForm.get('descripcion')?.invalid && createForm.get('descripcion')?.touched" class="mensaje-error">Descripción requerida.</div>

    <input formControlName="valor_unitario" placeholder="Valor Unitario" type="number" step="0.01" 
      [ngClass]="{'input-error': createForm.get('valor_unitario')?.invalid && createForm.get('valor_unitario')?.touched}" required min="0" />
    <div *ngIf="createForm.get('valor_unitario')?.invalid && createForm.get('valor_unitario')?.touched" class="mensaje-error">Valor inválido.</div>

    <input formControlName="proveedor" placeholder="Proveedor" type="text" 
      [ngClass]="{'input-error': createForm.get('proveedor')?.invalid && createForm.get('proveedor')?.touched}" required maxlength="30" pattern="^[A-Za-zÁÉÍÓÚáéíóúÑñ\s]{1,30}$" />
    <div *ngIf="createForm.get('proveedor')?.invalid && createForm.get('proveedor')?.touched" class="mensaje-error">Proveedor inválido.</div>

    <input formControlName="cantidad_disponible" placeholder="Cantidad Disponible" type="number" 
      [ngClass]="{'input-error': createForm.get('cantidad_disponible')?.invalid && createForm.get('cantidad_disponible')?.touched}" required min="1" />
    <div *ngIf="createForm.get('cantidad_disponible')?.invalid && createForm.get('cantidad_disponible')?.touched" class="mensaje-error">Cantidad disponible debe ser mayor a 0.</div>

    <input formControlName="cantidad_reservada" placeholder="Cantidad Reservada" type="number" 
      [ngClass]="{'input-error': createForm.get('cantidad_reservada')?.invalid && createForm.get('cantidad_reservada')?.touched}" required min="0" />
    <div *ngIf="createForm.get('cantidad_reservada')?.invalid && createForm.get('cantidad_reservada')?.touched" class="mensaje-error">Cantidad reservada no puede ser negativa.</div>

    <input formControlName="hora_actualizacion" type="time" required 
      [ngClass]="{'input-error': createForm.get('hora_actualizacion')?.invalid && createForm.get('hora_actualizacion')?.touched}" />
    <div *ngIf="createForm.get('hora_actualizacion')?.invalid && createForm.get('hora_actualizacion')?.touched" class="mensaje-error">Hora de actualización requerida.</div>

    <input formControlName="ultima_actualizacion" type="date" required 
      [ngClass]="{'input-error': createForm.get('ultima_actualizacion')?.invalid && createForm.get('ultima_actualizacion')?.touched}" />
    <div *ngIf="createForm.get('ultima_actualizacion')?.invalid && createForm.get('ultima_actualizacion')?.touched" class="mensaje-error">Fecha de última actualización requerida.</div>

    <button type="submit">Crear</button>
  </form>
</div>

<div *ngIf="selectedFilter === 'editar'" class="section-form">
  <h2>Editar Producto</h2>
  <form [formGroup]="editForm" (ngSubmit)="updateProduct()" class="form-group">
    <input type="number" formControlName="id_prod" placeholder="ID del Producto"
      [ngClass]="{'input-error': editForm.get('id_prod')?.invalid && editForm.get('id_prod')?.touched}" required min="1" />
    <div *ngIf="editForm.get('id_prod')?.invalid && editForm.get('id_prod')?.touched" class="mensaje-error">ID inválido (mayor a 0).</div>

    <input type="text" formControlName="nom_prod" placeholder="Nuevo Nombre"
      [ngClass]="{'input-error': editForm.get('nom_prod')?.invalid && editForm.get('nom_prod')?.touched}" required maxlength="30" pattern="^[A-Za-zÁÉÍÓÚáéíóúÑñ\s]{1,30}$" />
    <div *ngIf="editForm.get('nom_prod')?.invalid && editForm.get('nom_prod')?.touched" class="mensaje-error">Nombre inválido.</div>

    <input type="text" formControlName="descripcion" placeholder="Nueva Descripción"
      [ngClass]="{'input-error': editForm.get('descripcion')?.invalid && editForm.get('descripcion')?.touched}" required maxlength="100" />
    <div *ngIf="editForm.get('descripcion')?.invalid && editForm.get('descripcion')?.touched" class="mensaje-error">Descripción requerida.</div>

    <input type="number" formControlName="valor_unitario" placeholder="Nuevo Valor Unitario"
      [ngClass]="{'input-error': editForm.get('valor_unitario')?.invalid && editForm.get('valor_unitario')?.touched}" required min="0" />
    <div *ngIf="editForm.get('valor_unitario')?.invalid && editForm.get('valor_unitario')?.touched" class="mensaje-error">Valor inválido.</div>

    <input type="text" formControlName="proveedor" placeholder="Nuevo Proveedor"
      [ngClass]="{'input-error': editForm.get('proveedor')?.invalid && editForm.get('proveedor')?.touched}" required maxlength="30" pattern="^[A-Za-zÁÉÍÓÚáéíóúÑñ\s]{1,30}$" />
    <div *ngIf="editForm.get('proveedor')?.invalid && editForm.get('proveedor')?.touched" class="mensaje-error">Proveedor inválido.</div>

    <input type="number" formControlName="cantidad_total" placeholder="Cantidad Total"
      [ngClass]="{'input-error': editForm.get('cantidad_total')?.invalid && editForm.get('cantidad_total')?.touched}" required min="0" />
    <div *ngIf="editForm.get('cantidad_total')?.invalid && editForm.get('cantidad_total')?.touched" class="mensaje-error">Cantidad total inválida.</div>

    <input type="text" formControlName="img" placeholder="Imagen URL"
      [ngClass]="{'input-error': editForm.get('img')?.invalid && editForm.get('img')?.touched}" />
    <div *ngIf="editForm.get('img')?.invalid && editForm.get('img')?.touched" class="mensaje-error">Imagen inválida.</div>

    <button type="submit">Actualizar</button>
  </form>
</div>

<div class="section-form">
    <h2>Productos con soket</h2>
    <table>
        <thead>
            <tr>
                <th>ID Producto</th>
                <th>Nombre</th>
                <th>Descripción</th>
                <th>Valor Unitario</th>
                <th>Proveedor</th>
                <th>ID Stock</th>
                <th>Cantidad Disponible</th>
                <th>Cantidad Reservada</th>
                <th>Hora Actualizacion</th>
                <th>Ultima actualizacion</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let prod of products">
                <td>{{ prod.id_prod }}</td>
                <td>{{ prod.nom_prod }}</td>
                <td>{{ prod.descripcion }}</td>
                <td>{{ prod.valor_unitario | currency:'COP' }}</td>
                <td>{{ prod.proveedor }}</td>
                <td>{{ prod.id_stock }}</td>
                <td>{{ prod.cantidad_disponible }}</td>
                <td>{{ prod.cantidad_reservada }}</td>
                <td>{{ prod.hora_actualizacion }}</td>
                <td>{{ prod.ultima_actualizacion }}</td>
            </tr>
        </tbody>
    </table>
</div>
